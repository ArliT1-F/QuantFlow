<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Stock Trading Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .positive {
            color: #27ae60;
        }
        .negative {
            color: #e74c3c;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-running {
            background-color: #27ae60;
        }
        .status-stopped {
            background-color: #e74c3c;
        }
        .status-starting {
            background-color: #f39c12;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 2rem;
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-custom {
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
        }
        .sidebar {
            background: #f8f9fa;
            min-height: 100vh;
            padding: 1rem;
        }
        .nav-link {
            color: #495057;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }
        .nav-link.active {
            background-color: #007bff;
            color: white;
        }
        .nav-link:hover {
            background-color: #e9ecef;
        }
        .content-area {
            padding: 1rem;
        }
        .alert-custom {
            border-radius: 10px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <h4 class="mb-4"><i class="fas fa-robot"></i> Trading Bot</h4>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('portfolio')">
                        <i class="fas fa-briefcase"></i> Portfolio
                    </a>
                    <a class="nav-link" href="#" href="#" onclick="showSection('positions')">
                        <i class="fas fa-chart-line"></i> Positions
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('trades')">
                        <i class="fas fa-exchange-alt"></i> Trades
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('strategies')">
                        <i class="fas fa-cogs"></i> Strategies
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('risk')">
                        <i class="fas fa-shield-alt"></i> Risk Management
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('market')">
                        <i class="fas fa-chart-bar"></i> Market Data
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 content-area">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section">
                    <div class="dashboard-header">
                        <div class="container">
                            <h1><i class="fas fa-robot"></i> Automated Stock Trading Bot</h1>
                            <p class="lead">Real-time monitoring and control of your automated trading system</p>
                        </div>
                    </div>

                    <!-- Status Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="metric-label">Trading Status</div>
                                        <div class="metric-value" id="trading-status">
                                            <span class="status-indicator status-stopped"></span>Stopped
                                        </div>
                                    </div>
                                    <i class="fas fa-power-off fa-2x text-muted"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="metric-label">Portfolio Value</div>
                                        <div class="metric-value" id="portfolio-value">$0.00</div>
                                    </div>
                                    <i class="fas fa-dollar-sign fa-2x text-success"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="metric-label">Total P&L</div>
                                        <div class="metric-value" id="total-pnl">$0.00</div>
                                    </div>
                                    <i class="fas fa-chart-line fa-2x text-info"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="metric-label">Active Positions</div>
                                        <div class="metric-value" id="active-positions">0</div>
                                    </div>
                                    <i class="fas fa-briefcase fa-2x text-warning"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Control Buttons -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-custom" onclick="startTrading()">
                                    <i class="fas fa-play"></i> Start Trading
                                </button>
                                <button class="btn btn-danger btn-custom" onclick="stopTrading()">
                                    <i class="fas fa-stop"></i> Stop Trading
                                </button>
                                <button class="btn btn-info btn-custom" onclick="refreshData()">
                                    <i class="fas fa-sync"></i> Refresh Data
                                </button>
                                <button class="btn btn-warning btn-custom" onclick="testNotification()">
                                    <i class="fas fa-bell"></i> Test Alert
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5><i class="fas fa-chart-line"></i> Portfolio Performance</h5>
                                <div class="chart-container">
                                    <canvas id="portfolioChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5><i class="fas fa-chart-pie"></i> Position Distribution</h5>
                                <div class="chart-container">
                                    <canvas id="positionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Trades -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="metric-card">
                                <h5><i class="fas fa-history"></i> Recent Trades</h5>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Time</th>
                                                <th>Symbol</th>
                                                <th>Action</th>
                                                <th>Quantity</th>
                                                <th>Price</th>
                                                <th>Strategy</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recent-trades">
                                            <tr>
                                                <td colspan="7" class="text-center text-muted">No recent trades</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Section -->
                <div id="portfolio-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-briefcase"></i> Portfolio Overview</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Performance Metrics</h5>
                                <div id="portfolio-metrics">
                                    <p class="text-muted">Loading portfolio metrics...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Risk Metrics</h5>
                                <div id="risk-metrics">
                                    <p class="text-muted">Loading risk metrics...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Positions Section -->
                <div id="positions-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-chart-line"></i> Active Positions</h2>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Symbol</th>
                                    <th>Quantity</th>
                                    <th>Avg Price</th>
                                    <th>Current Price</th>
                                    <th>Unrealized P&L</th>
                                    <th>P&L %</th>
                                    <th>Stop Loss</th>
                                    <th>Take Profit</th>
                                </tr>
                            </thead>
                            <tbody id="positions-table">
                                <tr>
                                    <td colspan="8" class="text-center text-muted">No active positions</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Trades Section -->
                <div id="trades-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-exchange-alt"></i> Trading History</h2>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Action</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Fees</th>
                                    <th>Strategy</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="trades-table">
                                <tr>
                                    <td colspan="8" class="text-center text-muted">No trades found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Strategies Section -->
                <div id="strategies-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-cogs"></i> Trading Strategies</h2>
                    <div id="strategies-list">
                        <p class="text-muted">Loading strategies...</p>
                    </div>
                </div>

                <!-- Risk Management Section -->
                <div id="risk-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-shield-alt"></i> Risk Management</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Risk Limits</h5>
                                <div id="risk-limits">
                                    <p class="text-muted">Loading risk limits...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Daily Metrics</h5>
                                <div id="daily-risk-metrics">
                                    <p class="text-muted">Loading daily metrics...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Data Section -->
                <div id="market-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-chart-bar"></i> Market Data</h2>
                    <div class="row">
                        <div class="col-12">
                            <div class="metric-card">
                                <h5>Current Market Prices</h5>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Symbol</th>
                                                <th>Price</th>
                                                <th>Change</th>
                                                <th>Change %</th>
                                                <th>Volume</th>
                                                <th>Market Cap</th>
                                                <th>P/E Ratio</th>
                                            </tr>
                                        </thead>
                                        <tbody id="market-data-table">
                                            <tr>
                                                <td colspan="7" class="text-center text-muted">Loading market data...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" class="content-section" style="display: none;">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Trading Configuration</h5>
                                <form id="trading-config-form">
                                    <div class="mb-3">
                                        <label class="form-label">Max Position Size (%)</label>
                                        <input type="number" class="form-control" id="max-position-size" value="10" min="1" max="100">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Stop Loss (%)</label>
                                        <input type="number" class="form-control" id="stop-loss" value="5" min="1" max="50">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Take Profit (%)</label>
                                        <input type="number" class="form-control" id="take-profit" value="15" min="1" max="100">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Save Settings</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5>Notification Settings</h5>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="email-notifications" checked>
                                    <label class="form-check-label" for="email-notifications">
                                        Email Notifications
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="trade-notifications" checked>
                                    <label class="form-check-label" for="trade-notifications">
                                        Trade Notifications
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="risk-alerts" checked>
                                    <label class="form-check-label" for="risk-alerts">
                                        Risk Alerts
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let portfolioChart, positionChart;
        let refreshInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            refreshData();
            startAutoRefresh();
        });

        // Initialize charts
        function initializeCharts() {
            // Portfolio performance chart
            const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
            portfolioChart = new Chart(portfolioCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });

            // Position distribution chart
            const positionCtx = document.getElementById('positionChart').getContext('2d');
            positionChart = new Chart(positionCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Show section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });

            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName + '-section').style.display = 'block';

            // Add active class to clicked nav link
            event.target.classList.add('active');

            // Load section data
            loadSectionData(sectionName);
        }

        // Load section data
        function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'dashboard':
                    refreshData();
                    break;
                case 'portfolio':
                    loadPortfolioData();
                    break;
                case 'positions':
                    loadPositionsData();
                    break;
                case 'trades':
                    loadTradesData();
                    break;
                case 'strategies':
                    loadStrategiesData();
                    break;
                case 'risk':
                    loadRiskData();
                    break;
                case 'market':
                    loadMarketData();
                    break;
            }
        }

        // Refresh all data
        async function refreshData() {
            try {
                await Promise.all([
                    loadTradingStatus(),
                    loadPortfolioOverview(),
                    loadRecentTrades(),
                    loadMarketData()
                ]);
            } catch (error) {
                console.error('Error refreshing data:', error);
                showAlert('Error refreshing data: ' + error.message, 'danger');
            }
        }

        // Load trading status
        async function loadTradingStatus() {
            try {
                const response = await fetch('/api/v1/trading/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('trading-status');
                const indicator = statusElement.querySelector('.status-indicator');
                
                if (data.is_running) {
                    indicator.className = 'status-indicator status-running';
                    statusElement.innerHTML = '<span class="status-indicator status-running"></span>Running';
                } else {
                    indicator.className = 'status-indicator status-stopped';
                    statusElement.innerHTML = '<span class="status-indicator status-stopped"></span>Stopped';
                }
            } catch (error) {
                console.error('Error loading trading status:', error);
            }
        }

        // Load portfolio overview
        async function loadPortfolioOverview() {
            try {
                const response = await fetch('/api/v1/portfolio/overview');
                const data = await response.json();
                
                const metrics = data.portfolio_metrics;
                
                document.getElementById('portfolio-value').textContent = 
                    '$' + metrics.total_value.toLocaleString('en-US', {minimumFractionDigits: 2});
                
                const totalPnl = metrics.total_pnl || 0;
                const pnlElement = document.getElementById('total-pnl');
                pnlElement.textContent = '$' + totalPnl.toLocaleString('en-US', {minimumFractionDigits: 2});
                pnlElement.className = 'metric-value ' + (totalPnl >= 0 ? 'positive' : 'negative');
                
                document.getElementById('active-positions').textContent = metrics.num_positions || 0;
                
            } catch (error) {
                console.error('Error loading portfolio overview:', error);
            }
        }

        // Load recent trades
        async function loadRecentTrades() {
            try {
                const response = await fetch('/api/v1/portfolio/trades?limit=10');
                const data = await response.json();
                
                const tbody = document.getElementById('recent-trades');
                
                if (data.trades.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No recent trades</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.trades.map(trade => `
                    <tr>
                        <td>${new Date(trade.timestamp).toLocaleString()}</td>
                        <td><strong>${trade.symbol}</strong></td>
                        <td><span class="badge ${trade.side === 'BUY' ? 'bg-success' : 'bg-danger'}">${trade.side}</span></td>
                        <td>${trade.quantity}</td>
                        <td>$${trade.price.toFixed(2)}</td>
                        <td>${trade.strategy}</td>
                        <td><span class="badge bg-success">${trade.status}</span></td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading recent trades:', error);
            }
        }

        // Load market data
        async function loadMarketData() {
            try {
                const response = await fetch('/api/v1/market/data');
                const data = await response.json();
                
                const tbody = document.getElementById('market-data-table');
                
                if (!data.market_data || Object.keys(data.market_data).length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No market data available</td></tr>';
                    return;
                }
                
                tbody.innerHTML = Object.values(data.market_data).map(stock => `
                    <tr>
                        <td><strong>${stock.symbol}</strong></td>
                        <td>$${stock.price.toFixed(2)}</td>
                        <td class="${stock.change >= 0 ? 'positive' : 'negative'}">$${stock.change.toFixed(2)}</td>
                        <td class="${stock.change_percent >= 0 ? 'positive' : 'negative'}">${stock.change_percent.toFixed(2)}%</td>
                        <td>${stock.volume.toLocaleString()}</td>
                        <td>$${(stock.market_cap / 1000000000).toFixed(1)}B</td>
                        <td>${stock.pe_ratio ? stock.pe_ratio.toFixed(1) : 'N/A'}</td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading market data:', error);
            }
        }

        // Load portfolio data
        async function loadPortfolioData() {
            try {
                const response = await fetch('/api/v1/portfolio/overview');
                const data = await response.json();
                
                const metrics = data.portfolio_metrics;
                document.getElementById('portfolio-metrics').innerHTML = `
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Total Value:</strong> $${metrics.total_value.toLocaleString()}</p>
                            <p><strong>Cash Balance:</strong> $${metrics.cash_balance.toLocaleString()}</p>
                            <p><strong>Invested Amount:</strong> $${metrics.invested_amount.toLocaleString()}</p>
                        </div>
                        <div class="col-6">
                            <p><strong>Total Return:</strong> <span class="${metrics.total_return_percent >= 0 ? 'positive' : 'negative'}">${metrics.total_return_percent.toFixed(2)}%</span></p>
                            <p><strong>Sharpe Ratio:</strong> ${metrics.sharpe_ratio.toFixed(2)}</p>
                            <p><strong>Max Drawdown:</strong> ${metrics.max_drawdown.toFixed(2)}%</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading portfolio data:', error);
            }
        }

        // Load positions data
        async function loadPositionsData() {
            try {
                const response = await fetch('/api/v1/portfolio/positions');
                const data = await response.json();
                
                const tbody = document.getElementById('positions-table');
                
                if (data.positions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No active positions</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.positions.map(position => `
                    <tr>
                        <td><strong>${position.symbol}</strong></td>
                        <td>${position.quantity}</td>
                        <td>$${position.average_price.toFixed(2)}</td>
                        <td>$${position.current_price.toFixed(2)}</td>
                        <td class="${position.unrealized_pnl >= 0 ? 'positive' : 'negative'}">$${position.unrealized_pnl.toFixed(2)}</td>
                        <td class="${position.pnl_percentage >= 0 ? 'positive' : 'negative'}">${position.pnl_percentage.toFixed(2)}%</td>
                        <td>${position.stop_loss ? '$' + position.stop_loss.toFixed(2) : 'N/A'}</td>
                        <td>${position.take_profit ? '$' + position.take_profit.toFixed(2) : 'N/A'}</td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading positions data:', error);
            }
        }

        // Load trades data
        async function loadTradesData() {
            try {
                const response = await fetch('/api/v1/portfolio/trades?limit=50');
                const data = await response.json();
                
                const tbody = document.getElementById('trades-table');
                
                if (data.trades.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No trades found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.trades.map(trade => `
                    <tr>
                        <td>${new Date(trade.timestamp).toLocaleString()}</td>
                        <td><strong>${trade.symbol}</strong></td>
                        <td><span class="badge ${trade.side === 'BUY' ? 'bg-success' : 'bg-danger'}">${trade.side}</span></td>
                        <td>${trade.quantity}</td>
                        <td>$${trade.price.toFixed(2)}</td>
                        <td>$${trade.fees.toFixed(2)}</td>
                        <td>${trade.strategy}</td>
                        <td><span class="badge bg-success">${trade.status}</span></td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading trades data:', error);
            }
        }

        // Load strategies data
        async function loadStrategiesData() {
            try {
                const response = await fetch('/api/v1/strategies');
                const data = await response.json();
                
                const container = document.getElementById('strategies-list');
                
                if (data.strategies.length === 0) {
                    container.innerHTML = '<p class="text-muted">No strategies available</p>';
                    return;
                }
                
                container.innerHTML = data.strategies.map(strategy => `
                    <div class="metric-card">
                        <h5>${strategy.name}</h5>
                        <p><strong>Class:</strong> ${strategy.class_name}</p>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Total Trades:</strong> ${strategy.performance.total_trades}</p>
                                <p><strong>Win Rate:</strong> ${(strategy.performance.win_rate * 100).toFixed(1)}%</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Total P&L:</strong> <span class="${strategy.performance.total_pnl >= 0 ? 'positive' : 'negative'}">$${strategy.performance.total_pnl.toFixed(2)}</span></p>
                                <p><strong>Sharpe Ratio:</strong> ${strategy.performance.sharpe_ratio.toFixed(2)}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading strategies data:', error);
            }
        }

        // Load risk data
        async function loadRiskData() {
            try {
                const response = await fetch('/api/v1/risk/metrics');
                const data = await response.json();
                
                const metrics = data.risk_metrics;
                
                document.getElementById('risk-limits').innerHTML = `
                    <p><strong>Max Position Size:</strong> ${(metrics.max_position_size * 100).toFixed(1)}%</p>
                    <p><strong>Max Portfolio Risk:</strong> ${(metrics.max_portfolio_risk * 100).toFixed(1)}%</p>
                    <p><strong>Max Daily Loss:</strong> ${(metrics.max_daily_loss * 100).toFixed(1)}%</p>
                    <p><strong>Max Daily Trades:</strong> ${metrics.max_daily_trades}</p>
                `;
                
                document.getElementById('daily-risk-metrics').innerHTML = `
                    <p><strong>Daily Trades:</strong> ${metrics.daily_trades}</p>
                    <p><strong>Daily P&L:</strong> <span class="${metrics.daily_pnl >= 0 ? 'positive' : 'negative'}">$${metrics.daily_pnl.toFixed(2)}</span></p>
                    <p><strong>Last Reset:</strong> ${new Date(metrics.last_reset_date).toLocaleDateString()}</p>
                `;
                
            } catch (error) {
                console.error('Error loading risk data:', error);
            }
        }

        // Trading controls
        async function startTrading() {
            try {
                const response = await fetch('/api/v1/trading/start', { method: 'POST' });
                const data = await response.json();
                
                showAlert(data.message, 'success');
                setTimeout(refreshData, 1000);
            } catch (error) {
                console.error('Error starting trading:', error);
                showAlert('Error starting trading: ' + error.message, 'danger');
            }
        }

        async function stopTrading() {
            try {
                const response = await fetch('/api/v1/trading/stop', { method: 'POST' });
                const data = await response.json();
                
                showAlert(data.message, 'success');
                setTimeout(refreshData, 1000);
            } catch (error) {
                console.error('Error stopping trading:', error);
                showAlert('Error stopping trading: ' + error.message, 'danger');
            }
        }

        async function testNotification() {
            try {
                const response = await fetch('/api/v1/notifications/test', { method: 'POST' });
                const data = await response.json();
                
                showAlert(data.message, 'info');
            } catch (error) {
                console.error('Error testing notification:', error);
                showAlert('Error testing notification: ' + error.message, 'danger');
            }
        }

        // Auto refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(refreshData, 30000); // Refresh every 30 seconds
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }

        // Show alert
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-custom`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Insert at the top of the content area
            const contentArea = document.querySelector('.content-area');
            contentArea.insertBefore(alertDiv, contentArea.firstChild);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
</body>
</html>